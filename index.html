<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EliteTraining</title>

  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0b0f17;
      color: #fff;
    }
    .app {
      max-width: 420px;
      margin: auto;
      padding: 16px;
    }
    .card {
      background: #121a29;
      border-radius: 16px;
      padding: 16px;
      margin-top: 16px;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 10px;
      border: none;
      font-size: 15px;
    }
    input {
      background: #1e2a45;
      color: #fff;
    }
    button {
      background: #44aaff;
      color: #000;
      font-weight: 600;
      cursor: pointer;
    }
    .secondary {
      background: #1e2a45;
      color: #fff;
    }
    .error {
      color: #ff6b6b;
      font-size: 14px;
      margin-top: 8px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <div class="app">

    <!-- LOGIN / SIGNUP -->
    <div id="authCard" class="card">
      <h2 id="authTitle">Connexion</h2>

      <input id="firstname" class="hidden" placeholder="Prénom" />
      <input id="email" type="email" placeholder="Email" />
      <input id="password" type="password" placeholder="Mot de passe" />

      <button id="authActionBtn">Se connecter</button>
      <button id="toggleModeBtn" class="secondary">Créer un compte</button>

      <div id="authError" class="error"></div>
    </div>

    <!-- APP -->
    <div id="appCard" class="card hidden">
      <h2>EliteTraining</h2>
      <p id="welcome"></p>
      <button id="logoutBtn" class="secondary">Déconnexion</button>
    </div>

  </div>

<script>
/* =========================
   FIREBASE INIT
========================= */
const firebaseConfig = {
  apiKey: "AIzaSyAPICbQrWgARovGaebUYYP-WwohxQAYtuw",
  authDomain: "programme-force.firebaseapp.com",
  projectId: "programme-force",
  storageBucket: "programme-force.firebasestorage.app",
  messagingSenderId: "1070910165788",
  appId: "1:1070910165788:web:8212aec95671abfbdb60d9"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

/* =========================
   UI LOGIC
========================= */
let mode = "login";

const authTitle = document.getElementById("authTitle");
const firstnameInput = document.getElementById("firstname");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const authActionBtn = document.getElementById("authActionBtn");
const toggleModeBtn = document.getElementById("toggleModeBtn");
const authError = document.getElementById("authError");

const authCard = document.getElementById("authCard");
const appCard = document.getElementById("appCard");
const welcome = document.getElementById("welcome");
const logoutBtn = document.getElementById("logoutBtn");

/* Toggle login / signup */
toggleModeBtn.onclick = () => {
  authError.textContent = "";
  if (mode === "login") {
    mode = "signup";
    authTitle.textContent = "Créer un compte";
    authActionBtn.textContent = "Créer mon compte";
    toggleModeBtn.textContent = "J'ai déjà un compte";
    firstnameInput.classList.remove("hidden");
  } else {
    mode = "login";
    authTitle.textContent = "Connexion";
    authActionBtn.textContent = "Se connecter";
    toggleModeBtn.textContent = "Créer un compte";
    firstnameInput.classList.add("hidden");
  }
};

/* Login / Signup */
authActionBtn.onclick = async () => {
  authError.textContent = "";
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();
  const firstname = firstnameInput.value.trim();

  try {
    if (mode === "login") {
      await auth.signInWithEmailAndPassword(email, password);
    } else {
      if (!firstname) {
        authError.textContent = "Le prénom est requis";
        return;
      }
      const cred = await auth.createUserWithEmailAndPassword(email, password);
      await cred.user.updateProfile({ displayName: firstname });
      await db.collection("users").doc(cred.user.uid).set({
        firstname,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }
  } catch (e) {
    authError.textContent = e.message;
  }
};

/* Auth state */
auth.onAuthStateChanged(user => {
  if (user) {
    authCard.classList.add("hidden");
    appCard.classList.remove("hidden");
    welcome.textContent = `Bienvenue ${user.displayName || ""}`;
  } else {
    authCard.classList.remove("hidden");
    appCard.classList.add("hidden");
  }
});

/* Logout */
logoutBtn.onclick = () => auth.signOut();
</script>
</body>
</html>