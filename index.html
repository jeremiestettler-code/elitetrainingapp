<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>EliteTraining</title>
</head>
<body>
<script type="module">
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
  import {
    getFirestore,
    collection,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";

  // ðŸ” Replace with your existing firebaseConfig if needed
  const firebaseConfig = window.firebaseConfig;
  const app = initializeApp(firebaseConfig);

  const auth = getAuth(app);
  const db = getFirestore(app);

  async function loadCustomSessions(uid) {
    const snap = await getDocs(collection(db, "users", uid, "customSessions"));
    const custom = {};
    snap.forEach(doc => {
      const d = doc.data();
      custom[`CUSTOM_${doc.id}`] = {
        name: d.name || "SÃ©ance personnalisÃ©e",
        warmup: d.warmup || [],
        items: d.items || [],
        cooldown: d.cooldown || [],
        source: "custom",
        estimatedMinutes: d.estimatedMinutes || null
      };
    });
    console.log("Custom sessions loaded:", Object.keys(custom).length);
    return custom;
  }

  onAuthStateChanged(auth, async (user) => {
    if (!user) return;
    if (!window.SESSIONS) return;

    const custom = await loadCustomSessions(user.uid);
    window.SESSIONS = { ...custom, ...window.SESSIONS };

    if (typeof window.renderSessions === "function") {
      window.renderSessions(window.SESSIONS);
    }
  });
</script>
</body>
</html>
